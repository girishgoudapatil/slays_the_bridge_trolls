Feature: Alice/Bob story - REST ANeIS style
    As an Australian Busines
    I need to be able to send and recieve electronic invoices
    So I can automate this uproductive paperwork
    And obtain secondary benefits of reliable information 

    Scenario: Send eInvoice
        Given "Alice" is the Seller
	And "Bob" is the Buyer
	And "AliceFS" is the SellerFinancialSoftware
	And "AliceGW" is the SellerGateway
	And "BobGW" is the BuyerGateway
	When "Alice" generates an eInvoice for "Bob" using "AliceFS" 
	Then "AliceFS" sends a low-trust eInvoice package to "AliceGW"
	And "AliceGW" discovers that "BobGW" is the appropriate Gateway for "Bob"
	And "AliceGW" sends the eInvoice to "BobGW"
	And "BobGW" sends a technical Acknowledgement to "AliceGW"
	And the eInvoice sits waiting on "BobGW"

    Scenario: Deliver eInvoice to the Buyer's Finaicial Software
    	Given "Bob" is the Buyer
	And "Alice" is the Seller
	And "BobFS" is the BuyerFinancialSoftware
	And "BobGW" is the BuyerGateway
	And "AliceGW" is the SellerGateway
	When "BobGW" is holding an eInvoice from "Alice" for "Bob"
	And "BobFS" checks "BobGW" for new eInvoices
	Then "BobFW" gets the eInvoice from "BobGW"

    Scenario: Buyer receives eInvoice
        Given "Bob" is the Buyer
        And "Alice" is the Seller	
        And "Alice" sent an eInvoice to "Bob"
        When "BobFS" checks "BobGW" for new eInvoices
        And "Bob" checks the InTray in "BobFS"
        Then "Bob" sees the eInvoice from "Alice" in his InTray

    Scenario: Buyer acknowledges eInvoice
        Given "Bob" is the Buyer
        And "Alice" is the Seller	
        And eInvoice "a2b123" was sent from "Alice" to "Bob"
        When "Bob" acknowledges "a2b123" as "Approved" using "BobFS"
        Then "BobFS" posts "Approved" ACK to "AliceGW"
	And "AliceGW" posts the ACK to a reliable ledgering service
	And "AliceGW" returns ledger reference to "BobFS"
	And "BobFS" verifies the ledger reference
	And "BobFS" indicates that the ACK is in the ledger
        
    Scenario: Seller Gateway validates low-trust eInvoice package
        Given "Alice" is the Seller
	And "AliceFS" is the SellerFinancialSoftware
	When "Alice" generates an eInvoice for "Bob" using "AliceFS"
	And "pkg" is the low-trust eInvoice package generated by "AliceFS"
	Then "pkg" contains an encrypted payload
	And "pkg" contains a recipient identifier
	And "pkg" contains a recipient identifier type

    Scenario: Buyer Financial Software validates eInvoice
        Given "Alice" is the Seller
	And "AliceGW" is the SellerFinancialSoftware
	